<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8">
  <meta name="viewport" content="width=device-width, initial-scale=1.0">
  <meta name="csrf-token" content="<%= csrfToken %>">
  
  <title><%= (typeof title !== 'undefined' && title ? title + ' | ' + site.name : site.name) %></title>
  <meta name="description" content="<%= (typeof description !== 'undefined' && description ? description : 'Discover scholarships and study abroad opportunities worldwide. Find funding for undergraduate, graduate, and doctoral programs.') %>">
  
  <!-- Open Graph / Facebook -->
  <meta property="og:type" content="website">
  <meta property="og:url" content="<%= site.url %><%= (typeof originalUrl !== 'undefined' ? originalUrl : '') %>">
  <meta property="og:title" content="<%= (typeof title !== 'undefined' && title ? title + ' | ' + site.name : site.name) %>">
  <meta property="og:description" content="<%= (typeof description !== 'undefined' && description ? description : 'Discover scholarships and study abroad opportunities worldwide.') %>">
  <meta property="og:image" content="<%= site.url %>/images/og-image.png">

  <!-- Twitter -->
  <meta property="twitter:card" content="summary_large_image">
  <meta property="twitter:url" content="<%= site.url %><%= (typeof originalUrl !== 'undefined' ? originalUrl : '') %>">
  <meta property="twitter:title" content="<%= (typeof title !== 'undefined' && title ? title + ' | ' + site.name : site.name) %>">
  <meta property="twitter:description" content="<%= (typeof description !== 'undefined' && description ? description : 'Discover scholarships and study abroad opportunities worldwide.') %>">
  <meta property="twitter:image" content="<%= site.url %>/images/twitter-card.png">

  <!-- Canonical URL -->
  <link rel="canonical" href="<%= site.url %><%= (typeof originalUrl !== 'undefined' ? originalUrl : '') %>">

  <!-- Bootstrap CSS -->
  <link href="https://cdn.jsdelivr.net/npm/bootstrap@5.3.0/dist/css/bootstrap.min.css" rel="stylesheet">
  
  <!-- Custom CSS -->
  <link rel="stylesheet" href="/css/main.css">
  <link rel="stylesheet" href="/css/animations.css">
  
  <!-- Favicon and Icons -->
  <link rel="icon" type="image/svg+xml" href="/favicon.svg">
  <link rel="icon" type="image/png" sizes="32x32" href="/favicon-32x32.png">
  <link rel="shortcut icon" href="/favicon.svg" type="image/svg+xml">
  <meta name="theme-color" content="#0055FF">

  <!-- Structured Data -->
  <% if (typeof structuredData !== 'undefined' && structuredData) { %>
    <script type="application/ld+json">
      <%- JSON.stringify(structuredData) %>
    </script>
  <% } %>

  <!-- Google Analytics -->
  <% if (site.ga) { %>
    <!-- Google tag (gtag.js) -->
    <script async src="https://www.googletagmanager.com/gtag/js?id=<%= site.ga %>"></script>
    <script>
      window.dataLayer = window.dataLayer || [];
      function gtag(){dataLayer.push(arguments);}
      gtag('js', new Date());
      gtag('config', '<%= site.ga %>');
    </script>
  <% } %>

  <!-- AdSense -->
  <% if (site.adsenseClient) { %>
    <script async src="https://pagead2.googlesyndication.com/pagead/js/adsbygoogle.js?client=<%= site.adsenseClient %>"
            crossorigin="anonymous"></script>
  <% } %>
</head>
<body>
  <!-- Navigation -->
  <nav class="navbar navbar-expand-lg navbar-light bg-white shadow-sm">
    <div class="container">
      <a class="navbar-brand" href="/">ScholarPathway</a>
      
      <button class="navbar-toggler" type="button" data-bs-toggle="collapse" data-bs-target="#navbarNav">
        <span class="navbar-toggler-icon"></span>
      </button>
      
      <div class="collapse navbar-collapse" id="navbarNav">
        <ul class="navbar-nav me-auto">
          <li class="nav-item">
            <a class="nav-link" href="/">Home</a>
          </li>
          <li class="nav-item">
            <a class="nav-link" href="/scholarships">Scholarships</a>
          </li>
          <li class="nav-item">
            <a class="nav-link" href="/tips">Tips</a>
          </li>
          <li class="nav-item">
            <a class="nav-link" href="/countries">Countries</a>
          </li>
          <li class="nav-item">
            <a class="nav-link" href="/about">About</a>
          </li>
          <li class="nav-item">
            <a class="nav-link" href="/contact">Contact</a>
          </li>
        </ul>
        
        <ul class="navbar-nav">
          <% if (user) { %>
            <li class="nav-item">
              <a class="nav-link" href="/admin">Admin</a>
            </li>
          <% } %>
        </ul>
      </div>
    </div>
  </nav>

  <!-- Main Content -->
  <main>
    <%- body %>
  </main>

  <!-- Footer -->
  <footer class="footer">
    <div class="container">
      <div class="row">
        <div class="col-lg-4 mb-4">
          <h5>ScholarPathway</h5>
          <p class="text-muted">Helping students worldwide find scholarship opportunities and achieve their educational dreams.</p>
          <div class="d-flex gap-3">
            <a href="#" class="text-muted"><i class="fab fa-facebook"></i></a>
            <a href="#" class="text-muted"><i class="fab fa-twitter"></i></a>
            <a href="#" class="text-muted"><i class="fab fa-linkedin"></i></a>
            <a href="#" class="text-muted"><i class="fab fa-instagram"></i></a>
          </div>
        </div>
        
        <div class="col-lg-2 col-md-6 mb-4">
          <h6>Explore</h6>
          <ul class="list-unstyled">
            <li><a href="/scholarships">Scholarships</a></li>
            <li><a href="/tips">Study Tips</a></li>
            <li><a href="/countries">Countries</a></li>
            <li><a href="/about">About Us</a></li>
          </ul>
        </div>
        
        <div class="col-lg-2 col-md-6 mb-4">
          <h6>Support</h6>
          <ul class="list-unstyled">
            <li><a href="/contact">Contact</a></li>
            <li><a href="/help">Help Center</a></li>
            <li><a href="/privacy">Privacy Policy</a></li>
            <li><a href="/terms">Terms of Service</a></li>
          </ul>
        </div>
        
        <div class="col-lg-4 mb-4">
          <h6>Stay Updated</h6>
          <p class="text-muted mb-3">Get the latest scholarship opportunities delivered to your inbox.</p>
          <form id="newsletter-form" class="d-flex gap-2">
            <input type="hidden" name="_csrf" value="<%= csrfToken %>">
            <input type="email" name="email" class="form-control" placeholder="Enter your email" required>
            <button type="submit" class="btn btn-primary">Subscribe</button>
          </form>
        </div>
      </div>

      <!-- Ad Placeholder -->
      <% if (site.adsenseClient) { %>
        <div class="row my-4">
          <div class="col-12">
            <!-- Ad unit code here -->
            <ins class="adsbygoogle"
                 style="display:block"
                 data-ad-client="<%= site.adsenseClient %>"
                 data-ad-slot="1234567890"
                 data-ad-format="auto"
                 data-full-width-responsive="true"></ins>
            <script>
                 (adsbygoogle = window.adsbygoogle || []).push({});
            </script>
          </div>
        </div>
      <% } else { %>
        <div class="ad-placeholder">
          <small>Advertisement</small>
        </div>
      <% } %>

      <hr>
      <div class="row align-items-center">
        <div class="col-md-6">
          <p class="text-muted mb-0">&copy; <%= new Date().getFullYear() %> ScholarPathway. Built with ❤️ for students worldwide.</p>
        </div>
        <div class="col-md-6 text-md-end">
          <p class="text-muted mb-0">Founded by Yeab</p>
        </div>
      </div>
    </div>
  </footer>

  <!-- Bootstrap JS -->
  <script src="https://cdn.jsdelivr.net/npm/bootstrap@5.3.0/dist/js/bootstrap.bundle.min.js"></script>
  
  <!-- Font Awesome -->
  <script src="https://kit.fontawesome.com/your-kit-id.js" crossorigin="anonymous"></script>
  
  <!-- Custom JS -->
  <script src="/js/main.js"></script>
  <script src="/js/animations.js"></script>
  
  <script>
  // Footer Newsletter Subscription
  document.addEventListener('DOMContentLoaded', function() {
    const footerForm = document.getElementById('newsletter-form');
    
    if (footerForm) {
      footerForm.addEventListener('submit', async function(e) {
        e.preventDefault();
        
        const email = this.querySelector('input[name="email"]').value.trim();
        const submitBtn = this.querySelector('button[type="submit"]');
        const originalText = submitBtn.textContent;
        
        if (!email || !email.includes('@')) {
          showToast('Please enter a valid email address', 'error');
          return;
        }
        
        submitBtn.textContent = 'Subscribing...';
        submitBtn.disabled = true;
        
        try {
          const formData = new FormData(this);
          formData.append('source', 'footer');
          const data = new URLSearchParams(formData);
          
          const response = await fetch('/subscribe', {
            method: 'POST',
            headers: {
              'Content-Type': 'application/x-www-form-urlencoded',
              'X-Requested-With': 'XMLHttpRequest'
            },
            body: data
          });
          
          const result = await response.json();
          
          if (response.ok && result.success) {
            showToast(result.success, 'success');
            this.reset();
          } else {
            showToast(result.error || 'Subscription failed. Please try again.', 'error');
          }
        } catch (error) {
          console.error('Newsletter subscription error:', error);
          showToast('Network error. Please try again.', 'error');
        } finally {
          submitBtn.textContent = originalText;
          submitBtn.disabled = false;
        }
      });
    }
  });
  
  // Simple toast notification function
  function showToast(message, type = 'info') {
    const existingToast = document.querySelector('.custom-toast');
    if (existingToast) {
      existingToast.remove();
    }
    
    const toast = document.createElement('div');
    toast.className = `custom-toast alert alert-${type === 'success' ? 'success' : type === 'error' ? 'danger' : 'info'} position-fixed`;
    toast.style.cssText = 'top: 20px; right: 20px; z-index: 9999; min-width: 300px; box-shadow: 0 4px 6px rgba(0,0,0,0.1);';
    toast.innerHTML = `
      <div class="d-flex align-items-center">
        <i class="fas fa-${type === 'success' ? 'check-circle' : type === 'error' ? 'exclamation-triangle' : 'info-circle'} me-2"></i>
        <span>${message}</span>
        <button type="button" class="btn-close ms-auto" onclick="this.parentElement.parentElement.remove()"></button>
      </div>
    `;
    
    document.body.appendChild(toast);
    
    // Auto-remove after 5 seconds
    setTimeout(() => {
      if (toast.parentNode) {
        toast.remove();
      }
    }, 5000);
  }
  </script>
  
  <!-- Search Suggestions -->
  <script src="/js/search-suggestions.js"></script>
</body>
</html>
