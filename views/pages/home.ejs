<!-- Hero Section -->
<section class="hero-section">
  <div class="container">
    <div class="row justify-content-center text-center">
      <div class="col-lg-8">
        <h1 class="hero-title">Find Your Dream Scholarship Today</h1>
        <p class="hero-subtitle">Discover thousands of scholarship opportunities worldwide. From undergraduate to doctoral programs, we help you find funding for your educational journey.</p>
        
        <!-- Search Bar -->
        <div class="search-bar mt-4">
          <form action="/scholarships" method="GET" class="d-flex">
            <input type="text" name="q" class="form-control" placeholder="Search scholarships, countries, or keywords..." aria-label="Search scholarships">
            <button type="submit" class="btn btn-light">
              <i class="fas fa-search"></i> Search
            </button>
          </form>
        </div>
      </div>
    </div>
  </div>
</section>

<!-- Featured Scholarships -->
<section class="py-5">
  <div class="container">
    <div class="row">
      <div class="col-12 text-center mb-5">
        <h2 class="display-6">Featured Scholarships</h2>
        <p class="text-muted">Hand-picked opportunities with upcoming deadlines</p>
      </div>
    </div>
    
    <div class="row">
      <% if (featuredScholarships && featuredScholarships.length > 0) { %>
        <% featuredScholarships.forEach(scholarship => { %>
          <div class="col-lg-4 col-md-6 mb-4">
            <div class="card scholarship-card h-100">
              <div class="card-body">
                <div class="d-flex justify-content-between align-items-start mb-2">
                  <span class="badge badge-country"><%= scholarship.country_code %></span>
                  <% if (scholarship.featured) { %>
                    <span class="badge badge-featured">Featured</span>
                  <% } %>
                </div>
                
                <h5 class="card-title">
                  <a href="/scholarships/<%= scholarship.slug %>" class="text-decoration-none">
                    <%= scholarship.title %>
                  </a>
                </h5>
                
                <p class="card-text text-muted"><%= scholarship.summary %></p>
                
                <div class="mb-3">
                  <% if (scholarship.degree_levels && scholarship.degree_levels.length > 0) { %>
                    <% scholarship.degree_levels.forEach(level => { %>
                      <span class="badge badge-degree me-1"><%= level %></span>
                    <% }) %>
                  <% } %>
                </div>
                
                <% if (scholarship.deadline) { %>
                  <div class="text-muted mb-3">
                    <i class="fas fa-calendar-alt"></i>
                    <small>Deadline: <%= new Date(scholarship.deadline).toLocaleDateString('en-US', { year: 'numeric', month: 'long', day: 'numeric' }) %></small>
                  </div>
                <% } %>
                
                <div class="mt-auto">
                  <a href="/scholarships/<%= scholarship.slug %>" class="btn btn-outline-primary btn-sm">Learn More</a>
                  <a href="<%= scholarship.official_link %>" class="btn btn-primary btn-sm" target="_blank" rel="noopener">Apply Now</a>
                </div>
              </div>
            </div>
          </div>
        <% }) %>
      <% } else { %>
        <div class="col-12 text-center">
          <p class="text-muted">No featured scholarships available at the moment. Check back soon!</p>
        </div>
      <% } %>
    </div>
    
    <div class="text-center mt-4">
      <a href="/scholarships" class="btn btn-primary btn-lg">View All Scholarships</a>
    </div>
  </div>
</section>

<!-- Browse by Country -->
<section class="py-5 bg-light">
  <div class="container">
    <div class="row">
      <div class="col-12 text-center mb-5">
        <h2 class="display-6">Browse by Country</h2>
        <p class="text-muted">Explore scholarship opportunities by destination</p>
      </div>
    </div>
    
    <div class="country-grid">
      <% if (countries && countries.length > 0) { %>
        <% countries.forEach(country => { %>
          <a href="/countries/<%= country.code %>" class="country-item">
            <span class="country-flag">
              <%= country.flag || '🌍' %>
            </span>
            <div>
              <h6 class="mb-1"><%= country.name %></h6>
              <small class="text-muted">
                <%= country.count || country.scholarship_count || 0 %> 
                <%= ((country.count || country.scholarship_count || 0) === 1) ? 'scholarship' : 'scholarships' %>
              </small>
            </div>
          </a>
        <% }) %>
      <% } else { %>
        <div class="col-12 text-center">
          <p class="text-muted">Countries will be loaded here.</p>
        </div>
      <% } %>
    </div>
    
    <div class="text-center mt-4">
      <a href="/countries" class="btn btn-outline-primary">View All Countries</a>
    </div>
  </div>
</section>

<!-- Latest Tips -->
<section class="py-5">
  <div class="container">
    <div class="row">
      <div class="col-12 text-center mb-5">
        <h2 class="display-6">Latest Study Tips</h2>
        <p class="text-muted">Expert advice to boost your scholarship applications</p>
      </div>
    </div>
    
    <div class="row">
      <% if (latestPosts && latestPosts.length > 0) { %>
        <% latestPosts.forEach(post => { %>
          <div class="col-lg-4 col-md-6 mb-4">
            <div class="card h-100">
              <div class="card-body">
                <% if (post.featured) { %>
                  <span class="badge badge-featured mb-2">Featured</span>
                <% } %>
                
                <h5 class="card-title">
                  <a href="/tips/<%= post.slug %>" class="text-decoration-none">
                    <%= post.title %>
                  </a>
                </h5>
                
                <p class="card-text text-muted"><%= post.summary %></p>
                
                <% if (post.tags && post.tags.length > 0) { %>
                  <div class="mb-3">
                    <% post.tags.forEach(tag => { %>
                      <span class="badge bg-secondary me-1"><%= tag %></span>
                    <% }) %>
                  </div>
                <% } %>
                
                <div class="text-muted mb-3">
                  <small>
                    <i class="fas fa-clock"></i>
                    <%= new Date(post.created_at).toLocaleDateString('en-US', { year: 'numeric', month: 'long', day: 'numeric' }) %>
                  </small>
                </div>
                
                <a href="/tips/<%= post.slug %>" class="btn btn-outline-primary btn-sm">Read More</a>
              </div>
            </div>
          </div>
        <% }) %>
      <% } else { %>
        <div class="col-12 text-center">
          <p class="text-muted">No tips available at the moment. Check back soon!</p>
        </div>
      <% } %>
    </div>
    
    <div class="text-center mt-4">
      <a href="/tips" class="btn btn-primary">View All Tips</a>
    </div>
  </div>
</section>

<!-- Newsletter Signup CTA -->
<section class="py-5 bg-brand text-white">
  <div class="container">
    <div class="row justify-content-center text-center">
      <div class="col-lg-6">
        <h3>Never Miss an Opportunity</h3>
        <p class="mb-4">Get the latest scholarships and study abroad tips delivered to your inbox weekly.</p>
        
        <form id="newsletter-form-cta" class="d-flex gap-2 justify-content-center flex-column flex-sm-row align-items-center">
          <input type="hidden" name="_csrf" value="<%= csrfToken %>">
          <div class="position-relative" style="max-width: 350px; width: 100%;">
            <input type="email" name="email" class="form-control form-control-lg" placeholder="Enter your email address" required>
            <div id="email-feedback" class="invalid-feedback"></div>
          </div>
          <button type="submit" class="btn btn-light btn-lg px-4" id="newsletter-submit-btn">
            <i class="fas fa-envelope me-2"></i>Subscribe Free
          </button>
        </form>
        
        <div id="newsletter-message" class="mt-3 d-none"></div>
        
        <p class="small mt-3 opacity-75">
          <i class="fas fa-check me-1"></i> Free weekly updates 
          <i class="fas fa-check me-1 ms-3"></i> No spam, unsubscribe anytime
        </p>
      </div>
    </div>
  </div>
</section>

<!-- Sidebar Ad (Desktop only) -->
<% if (site.adsenseClient) { %>
  <div class="d-none d-lg-block position-fixed" style="right: 20px; top: 50%; transform: translateY(-50%); z-index: 1000;">
    <ins class="adsbygoogle"
         style="display:inline-block;width:160px;height:600px"
         data-ad-client="<%= site.adsenseClient %>"
         data-ad-slot="0987654321"></ins>
    <script>
         (adsbygoogle = window.adsbygoogle || []).push({});
    </script>
  </div>
<% } else { %>
  <div class="d-none d-lg-block position-fixed bg-light border p-3 text-center" style="right: 20px; top: 50%; transform: translateY(-50%); z-index: 1000; width: 160px; height: 200px;">
    <small class="text-muted">Advertisement</small>
  </div>
<% } %>

<script>
// Enhanced Newsletter Subscription Handler
document.addEventListener('DOMContentLoaded', function() {
  const form = document.getElementById('newsletter-form-cta');
  const submitBtn = document.getElementById('newsletter-submit-btn');
  const messageDiv = document.getElementById('newsletter-message');
  const emailInput = form.querySelector('input[name="email"]');
  const feedbackDiv = document.getElementById('email-feedback');
  
  if (form) {
    form.addEventListener('submit', async function(e) {
      e.preventDefault();
      
      // Reset previous states
      emailInput.classList.remove('is-valid', 'is-invalid');
      feedbackDiv.textContent = '';
      messageDiv.className = 'mt-3 d-none';
      
      const email = emailInput.value.trim();
      
      // Client-side validation
      if (!email) {
        showError('Please enter your email address');
        return;
      }
      
      if (!isValidEmail(email)) {
        showError('Please enter a valid email address');
        return;
      }
      
      // Show loading state
      const originalBtnText = submitBtn.innerHTML;
      submitBtn.innerHTML = '<i class="fas fa-spinner fa-spin me-2"></i>Subscribing...';
      submitBtn.disabled = true;
      
      try {
        const formData = new FormData(form);
        formData.append('source', 'home-cta');
        
        const response = await fetch('/subscribe', {
          method: 'POST',
          headers: {
            'X-Requested-With': 'XMLHttpRequest'
          },
          body: formData
        });
        
        const result = await response.json();
        
        if (response.ok && result.success) {
          showSuccess(result.success);
          form.reset();
          emailInput.classList.add('is-valid');
          
          // Track successful subscription
          if (typeof gtag !== 'undefined') {
            gtag('event', 'subscribe', {
              'event_category': 'engagement',
              'event_label': 'newsletter_home_cta'
            });
          }
        } else {
          showError(result.error || 'Subscription failed. Please try again.');
        }
      } catch (error) {
        console.error('Newsletter subscription error:', error);
        showError('Network error. Please check your connection and try again.');
      } finally {
        // Restore button state
        submitBtn.innerHTML = originalBtnText;
        submitBtn.disabled = false;
      }
    });
    
    // Real-time email validation
    emailInput.addEventListener('input', function() {
      const email = this.value.trim();
      if (email && !isValidEmail(email)) {
        this.classList.add('is-invalid');
        this.classList.remove('is-valid');
        feedbackDiv.textContent = 'Please enter a valid email address';
      } else if (email && isValidEmail(email)) {
        this.classList.add('is-valid');
        this.classList.remove('is-invalid');
        feedbackDiv.textContent = '';
      } else {
        this.classList.remove('is-valid', 'is-invalid');
        feedbackDiv.textContent = '';
      }
    });
  }
  
  function showError(message) {
    messageDiv.className = 'mt-3 alert alert-danger';
    messageDiv.innerHTML = '<i class="fas fa-exclamation-triangle me-2"></i>' + message;
    emailInput.classList.add('is-invalid');
    feedbackDiv.textContent = message;
  }
  
  function showSuccess(message) {
    messageDiv.className = 'mt-3 alert alert-success';
    messageDiv.innerHTML = '<i class="fas fa-check-circle me-2"></i>' + message;
  }
  
  function isValidEmail(email) {
    const emailRegex = /^[^\s@]+@[^\s@]+\.[^\s@]+$/;
    return emailRegex.test(email);
  }
});
</script>
